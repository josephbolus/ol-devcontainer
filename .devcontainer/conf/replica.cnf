[client-server]
#!includedir /etc/my.cnf.d

[mysqld]

# GENERAL #
server-id=2
user=mysql
# bind-address=0.0.0.0
binlog-ignore-db=mysql
binlog-ignore-db=information_schema
binlog-ignore-db=performance_schema
binlog_format=ROW
activate_all_roles_on_login=ON

# Load semi-sync replication plugin
#plugin-load-add = rpl_semi_sync_replica=semisync_replica.so
#rpl_semi_sync_replica = 1

# MyISAM #
key-buffer-size=64M
sort_buffer_size=8M
join_buffer_size=128M
read_buffer_size=2M
read_rnd_buffer_size=64M
bulk_insert_buffer_size=64M

# SAFETY #
connect_timeout=10
max-allowed-packet=1G
max-connect-errors=1000000
sysdate-is-now=1
low_priority_updates=1
mysqlx=0

# INNODB SETTINGS
innodb_flush_log_at_trx_commit=0
innodb_doublewrite=OFF
innodb_parallel_read_threads=8
replica_parallel_workers = 8
relay_log=replica1-relay-bin
binlog_cache_size=16M

# innodb=FORCE  # Removed - deprecated in MySQL 8.0
innodb_flush_method=O_DIRECT
innodb_buffer_pool_size=1G
innodb_adaptive_hash_index=0
innodb_rollback_on_timeout=ON
innodb_buffer_pool_instances=8  # Reduced to 8 from 18
innodb_log_buffer_size=64M
innodb_redo_log_capacity=4G
innodb_io_capacity=400
binlog_expire_logs_seconds=604800
sync_binlog=0

# CACHES AND LIMITS # Dec 15, 2024
tmp-table-size=64M
max-heap-table-size=64M
max-connections=1000
thread-cache-size=100
open-files-limit=65535
table-definition-cache=4096
table-open-cache=4096

# LOGGING AND PATHS #
datadir=/data/mysql
socket=/data/mysql/mysql.sock
mysqlx_socket=/data/mysql/mysqlx.sock
log-error=/var/log/mysqld.log
log-bin=/data/mysql/binlog
slow-query-log=1
slow-query-log-file=/var/log/mysql-slow.log
pid-file=/var/run/mysqld/mysqld.pid
relay_log=/data/mysql/relay-log

# MySQL8 Security Hardening
#mysqlx_socket=/var/lib/mysql/mysqlx.sock
log-raw=OFF
skip-grant-tables=FALSE
# secure-file-priv=/var/lib/mysql-files
log-queries-not-using-indexes=1

# plugin-load=audit_log.so
# audit-log=FORCE_PLUS_PERMANENT
# audit_log_file=/var/log/mysql/audit.log
# audit_log_format=JSON
# audit_log_rotate_on_size=1024M
# audit_log_rotations=10

#ssl_ca=/var/lib/mysql-files/ca.pem
# ssl_ca=/data/mysql-files/combined-ca.pem
# ssl_cert=/data/mysql-files/server-cert.pem
# ssl_key=/data/mysql-files/server-key.pem
# require_secure_transport=ON

local-infile=0
sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'

character_set_server=utf8mb4
collation_server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
skip-character-set-client-handshake

# Ignore ephemeral tables not needed to be replicated
replicate-ignore-table=prd_gatordb.mv_metadata
replicate-ignore-table=prd_gatordb.mv_case_result_element
replicate-ignore-table=prd_gatordb.mv_case_result_element_new
replicate-ignore-table=prd_gatordb.mv_case_result_element_old
replicate-ignore-table=prd_gatordb.v_ref_element_stats
replicate-ignore-table=prd_gatordb.v_ref_element_stats_new
replicate-ignore-table=prd_gatordb.v_ref_element_stats_old

[mysql]
#socket=/var/lib/mysql/mysql.sock  # Fixed to match datadir path
